{"version":3,"sources":["/Users/rasmus/src2/jo/src/jo/asyncfs/asyncfs.js"],"names":[],"mappings":"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","file":"out","sourcesContent":["import fs from 'fs'\n\nexport default {\n\n// Async functions\nrename: wrap1(fs.rename),\nftruncate: wrap1(fs.ftruncate),\ntruncate: wrap1(fs.truncate),\nchown: wrap1(fs.chown),\nfchown: wrap1(fs.fchown),\nlchown: wrap1(fs.lchown),\nchmod: wrap1(fs.chmod),\nfchmod: wrap1(fs.fchmod),\nlchmod: wrap1(fs.lchmod),\nstat: wrap1_ignoreENOENT(fs.stat),\nlstat: wrap1_ignoreENOENT(fs.lstat),\nfstat: wrap1_ignoreENOENT(fs.fstat),\nlink: wrap1(fs.link),\nsymlink: wrap1(fs.symlink),\nreadlink: wrap1(fs.readlink),\nrealpath: wrap1(fs.realpath),\nunlink: wrap1(fs.unlink),\nrmdir: wrap1(fs.rmdir),\nmkdir: wrap1(fs.mkdir),\nmkdirs: mkdirs,\nreaddir: wrap1(fs.readdir),\nclose: wrap1(fs.close),\nopen: wrap1(fs.open),\nutimes: wrap1(fs.utimes),\nfutimes: wrap1(fs.futimes),\nfsync: wrap1(fs.fsync),\nwrite: wrap2(fs.write), // note: two different call signatures\nread: wrap2(fs.read),\nreadFile: wrap1(fs.readFile),\nwriteFile: wrap1(fs.writeFile),\nappendFile: wrap1(fs.appendFile),\naccess: wrap1_err2bool(fs.access),\ncopy: copy,\n\n// Non-serializable functions\nwatchFile: fs.watchFile,\nunwatchFile: fs.unwatchFile,\ncreateReadStream: fs.createReadStream,\ncreateWriteStream: fs.createWriteStream,\n\n// Types\nStats: fs.Stats,\nReadStream: fs.ReadStream,\nWriteStream: fs.WriteStream,\nFSWatcher: fs.FSWatcher,\n\n// Callback functions\nrenameAsync: fs.rename,\nftruncateAsync: fs.ftruncate,\ntruncateAsync: fs.truncate,\nchownAsync: fs.chown,\nfchownAsync: fs.fchown,\nlchownAsync: fs.lchown,\nchmodAsync: fs.chmod,\nfchmodAsync: fs.fchmod,\nlchmodAsync: fs.lchmod,\nstatAsync: fs.stat,\nlstatAsync: fs.lstat,\nfstatAsync: fs.fstat,\nlinkAsync: fs.link,\nsymlinkAsync: fs.symlink,\nreadlinkAsync: fs.readlink,\nrealpathAsync: fs.realpath,\nunlinkAsync: fs.unlink,\nrmdirAsync: fs.rmdir,\nmkdirAsync: fs.mkdir,\nreaddirAsync: fs.readdir,\ncloseAsync: fs.close,\nopenAsync: fs.open,\nutimesAsync: fs.utimes,\nfutimesAsync: fs.futimes,\nfsyncAsync: fs.fsync,\nwriteAsync: fs.write,\nreadAsync: fs.read,\nreadFileAsync: fs.readFile,\nwriteFileAsync: fs.writeFile,\nappendFileAsync: fs.appendFile,\nwatchAsync: fs.watch,\nexistsAsync: fs.exists,\naccessAsync: fs.access,\n\n// Export sync functions simply so we can use this module as a drop-in replacement for fs\nrenameSync: fs.renameSync,\nftruncateSync: fs.ftruncateSync,\ntruncateSync: fs.truncateSync,\nchownSync: fs.chownSync,\nfchownSync: fs.fchownSync,\nlchownSync: fs.lchownSync,\nchmodSync: fs.chmodSync,\nfchmodSync: fs.fchmodSync,\nlchmodSync: fs.lchmodSync,\nstatSync: fs.statSync,\nlstatSync: fs.lstatSync,\nfstatSync: fs.fstatSync,\nlinkSync: fs.linkSync,\nsymlinkSync: fs.symlinkSync,\nreadlinkSync: fs.readlinkSync,\nrealpathSync: fs.realpathSync,\nunlinkSync: fs.unlinkSync,\nrmdirSync: fs.rmdirSync,\nmkdirSync: fs.mkdirSync,\nreaddirSync: fs.readdirSync,\ncloseSync: fs.closeSync,\nopenSync: fs.openSync,\nutimesSync: fs.utimesSync,\nfutimesSync: fs.futimesSync,\nfsyncSync: fs.fsyncSync,\nwriteSync: fs.writeSync,\nreadSync: fs.readSync,\nreadFileSync: fs.readFileSync,\nwriteFileSync: fs.writeFileSync,\nappendFileSync: fs.appendFileSync,\naccessSync: fs.accessSync,\n\n}\n\nlet slice = Array.prototype.slice;\n\nfunction wrap1_ignoreENOENT(fn) { return function() {\n  let args = slice.call(arguments);\n  return new Promise((resolve, reject) => {\n    args.push(function(err, arg1) {\n      if (err) {\n        if (err.code === 'ENOENT') {\n          resolve(null)\n        } else {\n          reject(err)\n        }\n      } else {\n        resolve(arg1)\n      }\n    })\n    fn.apply(fs, args)\n  })\n}}\n\nfunction wrap1(fn) { return function() {\n  let args = Array.prototype.slice.call(arguments);\n  return new Promise((resolve, reject) => {\n    args.push(function(err, arg1) {\n      if (err) reject(err); else resolve(arg1)\n    })\n    fn.apply(fs, args)\n  })\n}}\n\nfunction wrap2(fn) { return function() {\n  let args = Array.prototype.slice.call(arguments);\n  return new Promise((resolve, reject) => {\n    args.push(function(err, arg1, arg2) {\n      if (err) reject(err); else resolve([arg1, arg2])\n    })\n    fn.apply(fs, args)\n  })\n}}\n\nfunction wrap1_err2bool(fn) { return function() {\n  let args = Array.prototype.slice.call(arguments);\n  return new Promise((resolve, reject) => {\n    args.push(err => { resolve(!err) })\n    fn.apply(fs, args)\n  })\n}}\n\nfunction mkdirs(path) {\n  return new Promise((resolve, reject) => {\n    _mkdirs(path, (err) => {\n      if (err) reject(err); else resolve();\n    })\n  })\n}\n// Example:\n// Here, \"/foo/bar\" exists:\n//   /foo/bar/baz/a/b  mkdir, fail ENOENT\n//   /foo/bar/baz/a    mkdir, fail ENOENT\n//   /foo/bar/baz      mkdir, success\n//   /foo/bar/baz/a    mkdir, success\n//   /foo/bar/baz/a/b  mkdir, success\n//                     done\n//\n// \nfunction _mkdirs(path, cb) {\n  fs.mkdir(path, function (err) {\n    if (!err || err.code === 'EEXIST') {\n      return cb();\n    } else if (err.code === 'ENOENT') {\n      path = require('path').resolve(path)\n      var p = path.lastIndexOf('/')\n      if (p === -1) {\n        cb(err)\n      } else {\n        _mkdirs(path.substr(0, p), (err) => {\n          if (err) {\n            cb(err)\n          } else {\n            fs.mkdir(path, (err) => {\n              cb(!err || err.code === 'EEXIST' ? null : err);\n            });\n          }\n        })\n      }\n    } else {\n      cb(err)\n    }\n  })\n}\n\nfunction copy(srcpath, dstpath) {\n  return new Promise((resolve, reject) => {\n    var completed = false, cb = function(err) {\n      if (!completed) {\n        completed = true\n        if (err) reject(err); else resolve();\n      }\n    }\n    var r = fs.createReadStream(srcpath), w = fs.createWriteStream(dstpath)\n    r.once('error', cb)\n    w.once('error', cb)\n    w.once('close', cb)\n    r.pipe(w)\n  })\n}\n"]}